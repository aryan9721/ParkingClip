"use strict";(self.webpackChunkParkingClip=self.webpackChunkParkingClip||[]).push([[955],{2982:function(e,t){t.Z="/server/parking-management-service/"},26955:function(e,t,n){n.r(t),n.d(t,{default:function(){return N}});var r=n(74165),a=n(15861),o=n(29439),i=n(72791),s=n(31243),l=n(50097),c=n(10765),u=n(85523),d=n(66362),p=n(17133),h=n(2982),f=n(77063),v=n(30097),g=n.n(v),m=n(34051),x=n(94026),j=n(20269),Z=n(90338),b=n(57689),y=n(19658),w=n(80184),N=function(){var e=(0,i.useState)(new Date),t=(0,o.Z)(e,2),n=t[0],v=t[1],N=(0,i.useState)(""),S=(0,o.Z)(N,2),k=S[0],C=S[1],I=JSON.parse(localStorage.getItem("userdata")),T=(0,i.useState)(""),D=(0,o.Z)(T,2),R=D[0],P=D[1],A=(0,i.useState)("Car"),O=(0,o.Z)(A,2),E=O[0],L=O[1],V=(0,i.useState)(""),J=(0,o.Z)(V,2),q=J[0],F=J[1],G=(0,i.useState)(""),M=(0,o.Z)(G,2),_=M[0],B=M[1],Q=(0,i.useState)(""),U=(0,o.Z)(Q,2),Y=U[0],z=U[1],H=(0,i.useState)(0),K=(0,o.Z)(H,2),W=K[0],X=K[1],$=(0,i.useState)(!1),ee=(0,o.Z)($,2),te=ee[0],ne=ee[1];(0,b.s0)();var re=JSON.parse(localStorage.getItem("userdata")),ae=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),n={attendantId:re.userId,vehicleType:E,mobileNo:R,vehicleRegistrationNo:(r=q,r.replace(/\s/g,"")),isValletApplicable:te,valletNumber:W},console.log("sending data: ",n),e.prev=3,B(""),z(""),e.next=8,s.Z.post(h.Z+"api/parkings/vehicle/generateTicket",n).then((function(e){console.log("response",e.data),C(e.data),B(e.data.message)}));case 8:e.next=14;break;case 10:e.prev=10,e.t0=e.catch(3),z(e.t0.response.data.message),console.error("error",e.t0.response.data.message);case 14:he("");case 15:case"end":return e.stop()}var r}),e,null,[[3,10]])})));return function(t){return e.apply(this,arguments)}}();(0,i.useEffect)((function(){var e=setInterval((function(){return v(new Date)}),1e3);return function(){clearInterval(e)}}));var oe=(0,i.useState)(!1),ie=(0,o.Z)(oe,2),se=ie[0],le=ie[1],ce=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),le(!0);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ue=(0,i.useState)(""),de=(0,o.Z)(ue,2),pe=de[0],he=de[1],fe=(0,i.useState)(null),ve=(0,o.Z)(fe,2),ge=ve[0],me=ve[1],xe=(0,i.useState)(null),je=(0,o.Z)(xe,2),Ze=(je[0],je[1]),be=(0,i.useRef)(null),ye=(0,i.useRef)(null),we=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({video:!0});case 2:t=e.sent,me(t),be.current.srcObject=t,be.current.play();case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ne=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n,a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Se(t),(a=new FormData).append("file",n),console.log(a),console.log("hi"),fetch("https://anpr-api.pushpak.cloud/api/v1/plate_number",{method:"POST",body:a}).then((function(e){return e.json()})).then((function(e){var t=e.plate_number;""===t?(we(),Ze(null),z("No LPN Detected, Please Retry again!!"),console.log("No LPN Detected")):(console.log(t),Ze(null),F(t))}));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function Se(e){for(var t=e.split(",")[1],n=e.split(";")[0].split("/")[1],r=atob(t),a=new ArrayBuffer(r.length),o=new Uint8Array(a),i=0;i<r.length;i++)o[i]=r.charCodeAt(i);var s=new Blob([o],{type:"image/".concat(n)}),l="image_".concat(Date.now(),".").concat(n);return new File([s],l,{type:"image/".concat(n)})}var ke=(0,i.useState)([]),Ce=(0,o.Z)(ke,2),Ie=Ce[0],Te=Ce[1],De=(0,i.useState)("no location found"),Re=(0,o.Z)(De,2),Pe=(Re[0],Re[1]);(0,i.useEffect)((function(){Ae()}),[]);var Ae=function(){s.Z.get(h.Z+"api/businesses/"+re.businessId).then((function(e){Te(e.data.data.locations),Pe(e.data.data.locations[0].name)}))},Oe=Ie.find((function(e){return e.name===re.location})),Ee=Oe?Oe.vehicleDetails.map((function(e){return e.type})):[],Le=(0,i.useState)(!1),Ve=(0,o.Z)(Le,2),Je=Ve[0],qe=(Ve[1],(0,i.useState)(!1)),Fe=(0,o.Z)(qe,2),Ge=Fe[0],Me=Fe[1],_e=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log(k.data.vehicleRegistrationNo),s.Z.get(h.Z+"api/commons/vehicles/qrcode/"+k.data.vehicleRegistrationNo).then((function(e){Be(e.data)})).catch((function(e){console.error(e)}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();function Be(e){var t=window.open(),n=new Image;n.onload=function(){t.document.write('<img src="'.concat(e,'" />')),t.print(),t.close()},n.src=e}(0,i.useEffect)((function(){""!==_&&Me(!0)}),[_]);var Qe=function(){Me(!1),window.location.reload()};return(0,w.jsx)("div",{className:"home",children:(0,w.jsx)("div",{className:"homeContainer",children:(0,w.jsx)("div",{className:"body",children:(0,w.jsxs)("div",{className:"formContainer",children:[(0,w.jsx)("h3",{children:"Generate Parking Ticket"}),(0,w.jsxs)("form",{children:[""!==Y&&(0,w.jsx)(y.Z,{severity:"error",children:Y}),(0,w.jsxs)(m.Z,{open:Ge,onClose:Qe,children:[(0,w.jsx)(x.Z,{children:(0,w.jsx)("p",{children:_})}),(0,w.jsxs)(j.Z,{children:[(0,w.jsx)(Z.Z,{onClick:Qe,color:"primary",children:"Generate Another ticket"}),(0,w.jsx)(Z.Z,{onClick:function(){return _e()},color:"primary",children:"Print  QR"})]})]}),(0,w.jsxs)("div",{className:"formInput",children:[(0,w.jsx)("label",{children:"Parking Location"}),(0,w.jsx)("input",{disabled:!0,style:{backgroundColor:"lightgrey",color:"#000000"},type:"Text",value:I.location})]}),(0,w.jsxs)("div",{className:"formInput",children:[(0,w.jsx)("label",{children:"Entry date & time"}),(0,w.jsx)("input",{disabled:!0,style:{backgroundColor:"lightgrey",color:"#000000"},type:"Text",value:n.toDateString()+" "+n.toLocaleTimeString()})]}),(0,w.jsxs)("div",{style:{width:"100%",float:"left",flexDirection:"row"},children:[(0,w.jsx)("button",{style:{width:"47%"},onClick:ce,children:"Scan QR Code"}),se&&(0,w.jsx)(f.T,{delay:1e3,constraints:{facingMode:"environment"},onError:function(e){console.error(e)},onResult:function(e){if(""==pe&&e){he(JSON.parse(e));var t=JSON.parse(e);P(t.mobileNo),F(t.vehicleRegistrationNo),L(t.vehicleType),le(!1)}},style:{width:"100%"}}),null===ge?(0,w.jsx)("button",{style:{width:"47%",marginLeft:"5%"},onClick:we,children:"Scan Number Plate"}):(0,w.jsxs)("div",{children:[(0,w.jsx)(g(),{audio:!1,ref:ye,screenshotFormat:"image/jpeg",videoConstraints:{facingMode:"environment",width:"80%",torch:Je},className:"webcam"}),(0,w.jsx)("div",{children:(0,w.jsx)("button",{onClick:function(){var e=ye.current.getScreenshot();console.log(e),Ze(e),me(null),Ne(e)},children:"Take picture"})})]})]}),(0,w.jsxs)("div",{className:"formInput",children:[(0,w.jsx)("label",{children:"Select a vehicle type:"}),(0,w.jsx)("select",{id:"vehicleTypeSelect",onChange:function(e){var t=e.target.value;L(t)},children:Ee.map((function(e){return(0,w.jsx)("option",{value:e,children:e},e)}))})]}),(0,w.jsxs)("div",{className:"formInput",children:[(0,w.jsx)("label",{children:"Vehicle number"}),(0,w.jsx)("input",{id:"vehicleRegistrationNo",value:q,onChange:function(e){return F(e.target.value)},type:"Text"})]}),(0,w.jsxs)("div",{style:{width:"100%"},className:"formInput",children:[(0,w.jsx)("label",{children:"Contact Number"}),(0,w.jsx)("input",{required:!0,value:R,id:"mobileNo",onChange:function(e){return P(e.target.value)},style:{padding:"8px",border:"1px solid gray",borderRadius:"5px",height:"auto"},type:"tel"})]}),(0,w.jsxs)(d.Z,{style:{width:"48%"},children:[(0,w.jsx)(p.Z,{id:"demo-row-radio-buttons-group-label",children:"Allow Vallet Services??"}),(0,w.jsxs)(c.Z,{row:!0,"aria-labelledby":"demo-row-radio-buttons-group-label",name:"row-radio-buttons-group",onChange:function(e){return function(e){var t=e.target.value;ne(t)}(e)},defaultValue:"false",children:[(0,w.jsx)(u.Z,{value:"true",control:(0,w.jsx)(l.Z,{}),label:"Yes"}),(0,w.jsx)(u.Z,{value:"false",control:(0,w.jsx)(l.Z,{}),label:"No"})]})]}),"true"==te?(0,w.jsxs)("div",{className:"formInput",children:[(0,w.jsx)("label",{children:"Vallet Number"}),(0,w.jsx)("input",{required:!0,onChange:function(e){return function(e){var t=e.target.value;X(t)}(e)},type:Text})]}):null,(0,w.jsx)("div",{style:{alignItems:"center",justifyContent:"center",width:"100%",display:"flex"},children:(0,w.jsx)("button",{onClick:ae,children:"Generate a Ticket"})})]})]})})})})}}}]);
//# sourceMappingURL=955.0389233f.chunk.js.map